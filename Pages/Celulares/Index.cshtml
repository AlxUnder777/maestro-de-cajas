@page
@model MaestroDeCajasWeb.Pages.Celulares.IndexModel
@{
    ViewData["Title"] = "Gestion Celulares de Guardia";
}

<div class="menu-hero w-full max-w-6xl mx-auto mt-10 mb-12 px-4 space-y-6">
    <div class="glass neon-border module-cel hud-panel">
        <div class="flex flex-col gap-5">
            <div class="panel-head">
                <div class="space-y-2">
                    <p class="panel-eyebrow text-orange-100/80">Celulares de Guardia</p>
                    <h2 class="panel-title">Gestion Celulares</h2>
                    <p class="panel-subtitle">Control de flota, estado y disponibilidad para guardias.</p>
                </div>
                <div class="panel-actions">
                    <div class="hud-search slim">
                        <span class="icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="7" />
                                <line x1="16.65" y1="16.65" x2="21" y2="21" />
                            </svg>
                        </span>
                        <input id="cel-search" type="search" placeholder="Buscar celular..." />
                    </div>
                    <div class="btn-row">
                        <a asp-page="Create" class="btn-arcade module-cel btn-arcade-sm font-semibold text-slate-900">
                            Nuevo Celular
                        </a>
                        <a asp-page="/Index" class="btn-arcade btn-arcade-neutral btn-arcade-sm font-semibold">
                            Volver
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @if (Model.CelularGuardiaList.Any())
    {
        <div class="glass neon-border module-cel hud-panel overflow-hidden">
            <div class="overflow-x-auto">
                <table class="hud-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Codigo Sucursal</th>
                            <th>MAC WiFi</th>
                            <th>Uso</th>
                            <th>Funcionando</th>
                            <th>Especificar Error</th>
                            <th>Ultima Actualizacion</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.CelularGuardiaList)
                        {
                            var funcionando = (item.FUNCIONANDO ?? "").Equals("SI", System.StringComparison.OrdinalIgnoreCase);
                            <tr>
                                <td>@item.Id</td>
                                <td>@item.COD_SUCURSAL</td>
                                <td>@item.MAC_WIFI</td>
                                <td>@item.USO</td>
                                <td>
                                    <span class="pill @(funcionando ? "pill-ok" : "pill-bad")">
                                        @(funcionando ? "SI" : "NO")
                                    </span>
                                </td>
                                <td>@item.ESPECIFICAR_ERROR</td>
                                <td>@item.UltimaActualizacion</td>
                                <td>
                                    <div class="flex flex-wrap gap-2">
                                        <a asp-page="Edit" asp-route-id="@item.Id" class="table-btn">Editar</a>
                                        <a asp-page="Delete" asp-route-id="@item.Id" class="table-btn table-btn-danger">Eliminar</a>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    else
    {
        <div class="glass neon-border module-cel hud-panel text-center text-gray-100">
            No hay registros de Celulares de Guardia.
            <a asp-page="Create" class="btn-arcade module-cel btn-arcade-sm font-semibold text-slate-900 ml-2 inline-flex">
                Crear el primero
            </a>
        </div>
    }
</div>

@section Scripts {
    <script>
        (() => {
            const nodes = Array.from(document.querySelectorAll('[data-rotate]'));

            nodes.forEach((el) => {
                const phrases = (el.dataset.rotate || "").split("|").map(s => s.trim()).filter(Boolean);
                if (!phrases.length) return;

                let phraseIndex = 0;
                let charIndex = 0;
                let deleting = false;

                const tick = () => {
                    const current = phrases[phraseIndex];
                    el.textContent = current.slice(0, charIndex);

                    const atEnd = charIndex === current.length;
                    const atStart = charIndex === 0;

                    if (!deleting && !atEnd) {
                        charIndex++;
                    } else if (!deleting && atEnd) {
                        deleting = true;
                        setTimeout(tick, 1200);
                        return;
                    } else if (deleting && !atStart) {
                        charIndex--;
                    } else if (deleting && atStart) {
                        deleting = false;
                        phraseIndex = (phraseIndex + 1) % phrases.length;
                    }

                    const delay = deleting ? 50 + Math.random() * 40 : 70 + Math.random() * 60;
                    setTimeout(tick, delay);
                };

                tick();
            });
        })();

        (() => {
            const input = document.getElementById('cel-search');
            const rows = Array.from(document.querySelectorAll('.hud-table tbody tr'));
            if (!input || !rows.length) return;

            input.addEventListener('input', () => {
                const q = input.value.trim().toLowerCase();
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(q) ? '' : 'none';
                });
            });
        })();
    </script>
}

